{% extends 'base.html' %}

{% block title %}{{ data.project_name }} - SuperMega++{% endblock %}

{% block extra_css %}
<style>
	.project-header {
		background-color: #f8f9fa;
		padding: 15px;
		border-radius: 5px;
		margin-bottom: 20px;
	}

	.file-explorer {
		max-height: 600px;
		overflow-y: auto;
	}

	.file-list-item {
		cursor: pointer;
		padding: 8px 12px;
		border-radius: 4px;
	}

	.file-list-item:hover {
		background-color: #f8f9fa;
	}

	.file-list-item.active {
		background-color: #007bff;
		color: white;
	}

	.code-container {
		position: relative;
		height: 500px;
		overflow: auto;
		border: 1px solid #dee2e6;
		border-radius: 0.25rem;
	}

	.code-content {
		font-family: monospace;
		padding: 1rem;
		min-height: 100%;
		margin: 0;
	}

	/* Syntax highlighting styles for light mode */
	.hljs-keyword {
		color: #0000ff;
	}

	.hljs-comment {
		color: #008000;
	}

	.hljs-string {
		color: #a31515;
	}

	.hljs-number {
		color: #098658;
	}

	.hljs-function {
		color: #795E26;
	}

	.hljs-preprocessor {
		color: #800080;
	}

	/* Syntax highlighting styles for dark mode */
	.dark-mode .code-container {
		background-color: #1e1e1e;
		color: #d4d4d4;
	}

	.dark-mode .hljs-keyword {
		color: #569CD6;
	}

	.dark-mode .hljs-comment {
		color: #6A9955;
	}

	.dark-mode .hljs-string {
		color: #CE9178;
	}

	.dark-mode .hljs-number {
		color: #B5CEA8;
	}

	.dark-mode .hljs-function {
		color: #DCDCAA;
	}

	.dark-mode .hljs-preprocessor {
		color: #C586C0;
	}
</style>
<!-- Highlight.js for syntax highlighting -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
{% endblock %}

{% block content %}
<div class="project-header">
	<div class="d-flex justify-content-between align-items-center">
		<h1>{{ data.project_name }}</h1>
		<div>
			<button class="btn btn-primary" id="saveProjectBtn">Save</button>
			<button class="btn btn-success" id="runProjectBtn">Run</button>
		</div>
	</div>
	{% if data.project_comment %}
	<p class="text-muted">{{ data.project_comment }}</p>
	{% endif %}

	<div class="row mt-3">
		<div class="col-md-3">
			<div class="form-check form-switch">
				<input class="form-check-input" type="checkbox" id="optimizationSwitch">
				<label class="form-check-label" for="optimizationSwitch">Enable Optimization</label>
			</div>
		</div>
		<div class="col-md-3">
			<select class="form-select" id="targetPlatform">
				<option selected>x86_64</option>
				<option>ARM</option>
				<option>RISC-V</option>
			</select>
		</div>
		<div class="col-md-3">
			<div class="form-check form-switch">
				<input class="form-check-input" type="checkbox" id="debugSwitch" checked>
				<label class="form-check-label" for="debugSwitch">Debug Mode</label>
			</div>
		</div>
		<div class="col-md-3">
			<button class="btn btn-outline-secondary" id="settingsBtn">Additional Settings</button>
		</div>
	</div>
</div>

<div class="row">
	<!-- File Explorer -->
	<div class="col-md-3">
		<div class="card mb-4">
			<div class="card-header">
				<h5>Files</h5>
			</div>
			<div class="card-body p-0">
				<div class="file-explorer" id="fileExplorer">
					<ul class="list-group list-group-flush">
						{% for file in project_files %}
						<li class="list-group-item file-list-item {% if file == default_file %}active{% endif %}"
							data-filename="{{ file }}">
							<i class="bi bi-file-earmark-text"></i> {{ file }}
						</li>
						{% endfor %}
					</ul>
				</div>
			</div>
		</div>
	</div>

	<!-- File Content Viewer -->
	<div class="col-md-9">
		<div class="card mb-4">
			<div class="card-header d-flex justify-content-between align-items-center">
				<h5 id="currentFileName">{{ default_file }}</h5>
				<div class="btn-group btn-group-sm">
					<button class="btn btn-outline-secondary" id="toggleThemeBtn">Dark Mode</button>
				</div>
			</div>
			<div class="card-body p-0">
				<div class="code-container" id="codeContainer">
					<pre><code class="code-content language-c" id="fileContent">{{ file_contents.get(default_file, '') }}</code></pre>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Hidden divs to store file contents -->
<div style="display: none;" id="fileContentsData">
	{% for filename, content in file_contents.items() %}
	<div data-filename="{{ filename }}">{{ content }}</div>
	{% endfor %}
</div>
{% endblock %}

{% block extra_js %}
<!-- Highlight.js for syntax highlighting -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/c.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/json.min.js"></script>

<script>
	document.addEventListener('DOMContentLoaded', function () {
		const fileContent = document.getElementById('fileContent');
		const currentFileName = document.getElementById('currentFileName');
		const codeContainer = document.getElementById('codeContainer');
		const fileItems = document.querySelectorAll('.file-list-item');
		const fileContentsData = document.getElementById('fileContentsData');

		// Get content for a specific file from the hidden data
		function getFileContent(filename) {
			const fileDiv = fileContentsData.querySelector(`div[data-filename="${filename}"]`);
			return fileDiv ? fileDiv.textContent : '';
		}

		// Determine language for syntax highlighting
		function getLanguageForFile(filename) {
			if (filename.endsWith('.json')) {
				return 'json';
			} else if (filename.endsWith('.c') || filename.endsWith('.h')) {
				return 'c';
			} else {
				return 'plaintext';
			}
		}

		// Initialize syntax highlighting
		hljs.highlightElement(fileContent);

		// Dark mode handling
		let isDarkMode = false;

		// Toggle theme button
		document.getElementById('toggleThemeBtn').addEventListener('click', function () {
			isDarkMode = !isDarkMode;

			if (isDarkMode) {
				document.body.classList.add('dark-mode');
				codeContainer.classList.add('bg-dark');
				this.textContent = 'Light Mode';
			} else {
				document.body.classList.remove('dark-mode');
				codeContainer.classList.remove('bg-dark');
				this.textContent = 'Dark Mode';
			}

			// Re-highlight code with new theme
			hljs.highlightElement(fileContent);
		});

		// File click handling
		fileItems.forEach(function (item) {
			item.addEventListener('click', function () {
				// Remove active class from all items
				fileItems.forEach(function (i) {
					i.classList.remove('active');
				});

				// Add active class to clicked item
				this.classList.add('active');

				// Get the filename
				const filename = this.getAttribute('data-filename');
				currentFileName.textContent = filename;

				// Get content from our hidden div
				const content = getFileContent(filename);
				fileContent.textContent = content;

				// Update language for syntax highlighting
				const language = getLanguageForFile(filename);
				fileContent.className = `code-content language-${language}`;

				// Re-highlight the code
				hljs.highlightElement(fileContent);
			});
		});

		// Mock functionality for the Save button
		document.getElementById('saveProjectBtn').addEventListener('click', function () {
			alert('Save functionality will be implemented in a future version.');
		});

		// Mock functionality for the Run button
		document.getElementById('runProjectBtn').addEventListener('click', function () {
			alert('Run functionality will be implemented in a future version.');
		});

		// Mock functionality for the Settings button
		document.getElementById('settingsBtn').addEventListener('click', function () {
			alert('Additional settings will be available in a future version.');
		});
	});
</script>
{% endblock %}
